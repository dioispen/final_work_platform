{% extends "base.html" %}
{% block title %}專案詳情{% endblock %}
{% block content %}
<div class="card">
    <h2>{{ project.title }}</h2>
    <p>{{ project.description }}</p>
    <p><strong>預算:</strong> ${{ project.budget }}</p>
    <p><strong>委託人:</strong> {{ project.client_name }}</p>
    <p><strong>狀態:</strong> <span class="status status-{{ project.status }}">
        {% if project.status == 'open' %}待接案
        {% elif project.status == 'assigned' %}已被接案
        {% endif %}
        <p><strong>更新時間:</strong> {{ project.updated_at }}</p>
    </span></p>
    {% if project.deadline and project.status == 'open' %}
    <p><strong>截止時間 (UTC):</strong> {{ project.deadline }}</p>
    {% endif %}
</div>

{% if my_bid %}
<div class="card">
    <h3>我的投標</h3>
    <p><strong>報價:</strong> ${{ my_bid.price }}</p>
    <p><strong>說明:</strong> {{ my_bid.message }}</p>
    <p><strong>檔案:</strong>
        {% if my_bid.file_path %}
            <a href="/{{ my_bid.file_path }}" target="_blank">下載 {{ my_bid.file_name }}</a>
        {% else %}
            尚無
        {% endif %}
    </p>
    <p><strong>狀態:</strong> <span class="status status-{{ my_bid.status }}">
        {% if my_bid.status == 'accepted' %}已接受
        {% elif my_bid.status == 'rejected' %}已拒絕
        {% else %}待處理
        {% endif %}
    </span></p>
</div>
{% elif project.status == 'open' %}
<div class="card">
    <h3>提交投標（需上傳 PDF 提案）</h3>
    <form method="POST" action="/contractor/project/{{ project.id }}/bid" enctype="multipart/form-data">
        <div class="form-group">
            <label>報價</label>
            <input type="number" name="price" required>
        </div>
        <div class="form-group">
            <label>說明</label>
            <textarea name="message" required></textarea>
        </div>
        <div class="form-group">
            <label>提案計畫書 (PDF)</label>
            <input type="file" name="file" accept="application/pdf" required>
        </div>
        <button type="submit" class="btn">提交投標</button>
    </form>
</div>
{% endif %}

<a href="/contractor/dashboard" class="btn">返回</a>
{% endblock %}