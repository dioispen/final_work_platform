{% extends "base.html" %}
{% block title %}專案詳情{% endblock %}
{% block content %}

<div class="card">
    <h2>{{ project.title }}</h2>
    <p>{{ project.description }}</p>
    <p><strong>預算：</strong>${{ project.budget }}</p>
    <p><strong>委託人：</strong>{{ project.client_name }}</p>
    <p><strong>狀態：</strong>
        <span class="status status-{{ project.status }}">
        {% if project.status == 'open' %}待接案
        {% elif project.status == 'assigned' %}已被接案
        {% elif project.status == 'completed' %}已完成
        {% endif %}
        </span>
    </p>
    <p><strong>更新時間：</strong>{{ project.updated_at }}</p>
</div>

{% if my_bid %}
<div class="card">
    <h3>我的投標</h3>
    <p><strong>報價：</strong>${{ my_bid.price }}</p>
    <p><strong>說明：</strong>{{ my_bid.message }}</p>
    <p><strong>狀態：</strong>
        <span class="status status-{{ my_bid.status }}">
        {% if my_bid.status == 'accepted' %}已接受
        {% elif my_bid.status == 'rejected' %}已拒絕
        {% else %}待處理
        {% endif %}
        </span>
    </p>
</div>
{% elif project.status == 'open' %}
<div class="card">
    <h3>提交投標</h3>
    <form method="POST" action="/contractor/project/{{ project.id }}/bid">
        <div class="form-group">
            <label>報價</label>
            <input type="number" name="price" required>
        </div>
        <div class="form-group">
            <label>說明</label>
            <textarea name="message" required></textarea>
        </div>
        <button type="submit" class="btn">提交投標</button>
    </form>
</div>
{% endif %}

<div class="card">
    <h3>委託人過去評價</h3>

    {% if rating %}
        <p><strong>平均分數：</strong>⭐ {{ rating.overall_avg }}（{{ rating.review_count }} 筆）</p>
        <ul>
            <li>需求合理性：{{ rating.avg_dim1 }}</li>
            <li>驗收難度：{{ rating.avg_dim2 }}</li>
            <li>合作態度：{{ rating.avg_dim3 }}</li>
        </ul>
        <hr>
    {% else %}
        <p>尚無評價</p>
    {% endif %}

    {% for r in reviews %}
        <div style="margin-bottom: 1rem;">
            <p><strong>{{ r.reviewer_name }}</strong>：</p>
            <p>{{ r.comment }}</p>
            <p>分數：{{ r.dim1 }} / {{ r.dim2 }} / {{ r.dim3 }}</p>
            <small>{{ r.created_at }}</small>
            <hr>
        </div>
    {% endfor %}

    {% if project.status == 'completed' and not has_reviewed %}
        <a class="btn" href="/review/form?project_id={{ project.id }}&target_id={{ target_id }}">
            評價委託人
        </a>
    {% endif %}
</div>

<a href="/contractor/dashboard" class="btn">返回</a>
{% endblock %}
