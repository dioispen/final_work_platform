{% extends "base.html" %}
{% block title %}投標列表{% endblock %}
{% block content %}

<div class="card">
    <h2>{{ project.title }} - 投標列表</h2>
    <p>{{ project.description }}</p>
    <p><strong>預算:</strong> ${{ project.budget }}</p>
</div>

{% if bids %}
    {% for bid in bids %}
    <div class="card">

        <h3>{{ bid.contractor_name }}</h3>

        <!-- ⭐ 承包者評價摘要 -->
        {% set r = bid.rating %}
        {% if r and r.review_count > 0 %}
            <p><strong>平均評分：</strong> ⭐ {{ r.overall_avg }}（{{ r.review_count }} 筆）</p>
            <ul>
                <li>產出品質：{{ r.avg_dim1 }}</li>
                <li>執行效率：{{ r.avg_dim2 }}</li>
                <li>合作態度：{{ r.avg_dim3 }}</li>
            </ul>

            <details>
                <summary style="cursor:pointer;">查看所有評論</summary>
                <div style="margin-top:1rem;">
                    {% for rv in bid.reviews %}
                        <p><strong>{{ rv.reviewer_name }}</strong>：</p>
                        <p>{{ rv.comment }}</p>
                        <p>分數：{{ rv.dim1 }} / {{ rv.dim2 }} / {{ rv.dim3 }}</p>
                        <small>{{ rv.created_at }}</small>
                        <hr>
                    {% endfor %}
                </div>
            </details>

        {% else %}
            <p>⚠ 此承包者目前沒有評價紀錄</p>
        {% endif %}

        <hr>

        <p><strong>報價:</strong> ${{ bid.price }}</p>
        <p><strong>說明:</strong> {{ bid.message }}</p>
        <p><strong>投標時間:</strong> {{ bid.updated_at }}</p>
        <p><strong>狀態:</strong>
            {% if bid.status == 'accepted' %}已接受
            {% elif bid.status == 'rejected' %}已拒絕
            {% else %}待處理
            {% endif %}
        </p>

        {% if project.status == 'open' and bid.status == 'pending' %}
        <form method="POST" action="/client/bid/{{ bid.id }}/accept" style="display:inline;">
            <button type="submit" class="btn btn-success">接受</button>
        </form>
        {% endif %}

    </div>
    {% endfor %}
{% else %}
    <div class="card">目前還沒有投標</div>
{% endif %}

<a href="/client/dashboard" class="btn">返回</a>

{% endblock %}
